#!/bin/bash

while true; do
	GTX1080Ti_temperature=$(nvidia-smi --query-gpu=temperature.gpu --format=csv,noheader,nounits)

	case "${GTX1080Ti_temperature}" in
		0[0-9])
			fan_speed="15"
			;;
		10)
			fan_speed="12"
			;;
		11)
			fan_speed="12"
			;;
		12)
			fan_speed="12"
			;;
		13)
			fan_speed="12"
			;;
		14)
			fan_speed="12"
			;;
		15)
			fan_speed="12"
			;;
		16)
			fan_speed="12"
			;;
		17)
			fan_speed="12"
			;;
		18)
			fan_speed="13"
			;;
		19)
			fan_speed="13"
			;;
		20)
			fan_speed="13"
			;;
		21)
			fan_speed="13"
			;;
		22)
			fan_speed="14"
			;;
		23)
			fan_speed="14"
			;;
		24)
			fan_speed="14"
			;;
		25)
			fan_speed="14"
			;;
		26)
			fan_speed="15"
			;;
		27)
			fan_speed="15"
			;;
		28)
			fan_speed="15"
			;;
		29)
			fan_speed="15"
			;;
		30)
			fan_speed="16"
			;;
		31)
			fan_speed="16"
			;;
		32)
			fan_speed="17"
			;;
		33)
			fan_speed="17"
			;;
		34)
			fan_speed="18"
			;;
		35)
			fan_speed="18"
			;;
		36)
			fan_speed="19"
			;;
		37)
			fan_speed="19"
			;;
		38)
			fan_speed="20"
			;;
		39)
			fan_speed="20"
			;;
		40)
			fan_speed="21"
			;;
		41)
			fan_speed="21"
			;;
		42)
			fan_speed="22"
			;;
		43)
			fan_speed="22"
			;;
		44)
			fan_speed="23"
			;;
		45)
			fan_speed="23"
			;;
		46)
			fan_speed="24"
			;;
		47)
			fan_speed="24"
			;;
		48)
			fan_speed="25"
			;;
		49)
			fan_speed="26"
			;;
		50)
			fan_speed="28"
			;;
		51)
			fan_speed="30"
			;;
		52)
			fan_speed="35"
			;;
		53)
			fan_speed="40"
			;;
		54)
			fan_speed="46"
			;;
		55)
			fan_speed="52"
			;;
		56)
			fan_speed="58"
			;;
		57)
			fan_speed="64"
			;;
		58)
			fan_speed="70"
			;;
		59)
			fan_speed="76"
			;;
		60)
			fan_speed="83"
			;;
		61)
			fan_speed="89"
			;;
		62)
			fan_speed="94"
			;;
		63)
			fan_speed="97"
			;;
		64)
			fan_speed="98"
			;;
		65)
			fan_speed="98"
			;;
		66)
			fan_speed="99"
			;;
		67)
			fan_speed="99"
			;;
		68)
			fan_speed="100"
			;;
		69)
			fan_speed="100"
			;;
		70)
			fan_speed="100"
			;;
		71)
			fan_speed="100"
			;;
		72)
			fan_speed="100"
			;;
		73)
			fan_speed="100"
			;;
		74)
			fan_speed="100"
			;;
		75)
			fan_speed="100"
			;;
		76)
			fan_speed="100"
			;;
		77)
			fan_speed="100"
			;;
		78)
			fan_speed="100"
			;;
		79)
			fan_speed="100"
			;;
		80)
			fan_speed="100"
			;;
		*)
			fan_speed="100"
			;;
	esac

	nvidia-settings -a "[gpu:0]/GPUFanControlState=1" 2>&1 >/dev/null
	nvidia-settings -a "[fan-0]/GPUTargetFanSpeed=${fan_speed}" 2>&1 >/dev/null

	sleep 1s

done